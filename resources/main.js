const data = {"0" : {name: "Art", imgUrl: "resources/img/Art.jpg", longitude:16.603373738961409, latitude:49.204186978229387, otherNames: ["Jugendkino", "Studio", "Kino náročného diváka"]},
"1" : {name: "Astra", imgUrl: "", longitude:16.643282126278734, latitude:49.201342788954165, otherNames: ["Kino Sokol", "Hvězda"]},
"2" : {name: "Bio Jas Husovice", imgUrl: "resources/img/Jas.png", longitude:16.636497311000248, latitude:49.213012536011753, otherNames: []},
"3" : {name: "Čas", imgUrl: "resources/img/Cas.png", longitude:16.611677348986568, latitude:49.191389666128529, otherNames: ["Apollo", "Ohne Pause", "Aktualita"]},
"4" : {name: "Vlast", imgUrl: "resources/img/Vlast.png", longitude:16.622027653926690, latitude:49.180076868111804, otherNames: ["Kino Atlantik"]},
"5" : {name: "Dukla", imgUrl: "", longitude:16.600665005310685, latitude:49.202920401220588, otherNames: ["Kino Stadion"]},
 "6" : {name: "Hvězda", imgUrl: "", longitude:16.553491500102655, latitude:49.217529300366998, otherNames: ["Kino Komín"]},
 "7" : {name: "Jadran", imgUrl: "resources/img/Jadran.png", longitude:16.595550431548450, latitude:49.223679124352600, otherNames: ["Adria", "Bio Besední dům"]},
 "8" : {name: "Jalta", imgUrl: "resources/img/Jalta.jpeg", longitude:16.606333441544635, latitude:49.194223116939263, otherNames: ["Kino Moderna"]},
 "9" : {name: "Kapitol", imgUrl: "resources/img/Kapitol.png", longitude:16.614135113704798, latitude:49.195054457938845, otherNames: ["The Royal Bio Co.", "Elite Kino", "Družba"]},
 "10" : {name: "Kino Excelsior", imgUrl: "resources/img/Excelsior.png", longitude:16.605411779775292, latitude:49.192520803678747, otherNames: []},
 "11" : {name: "Kino Moravia", imgUrl: "resources/img/Moravia.png", longitude:16.606359403848000, latitude:49.203576311221532, otherNames: []},
 "12" : {name: "Kino Republika", imgUrl: "resources/img/Republika.png", longitude:16.606917593370277, latitude:49.195376810893663, otherNames: []},
 "13" : {name: "Kino Slávia Starý Lískovec", imgUrl: "", longitude:16.564910586531106, latitude:49.163510266646696, otherNames: []},
 "14" : {name: "Kino Slunce", imgUrl: "", longitude:16.562487438217360, latitude:49.180438917707157, otherNames: []},
 "15" : {name: "Kino Vesmír", imgUrl: "", longitude:16.551449132238215, latitude:49.209072042807925, otherNames: []},
 "16" : {name: "Květen", imgUrl: "", longitude:16.599289003232524, latitude:49.215584711490401, otherNames: ["Vitagraf", "Illusion", "Elektra"]},
 "17" : {name: "Lípa", imgUrl: "resources/img/Lipa.png", longitude:16.623343077297044, latitude:49.201342788954101, otherNames: []},
 "18" : {name: "Lucerna", imgUrl: "resources/img/Lucerna.png", longitude:16.585546290653109, latitude:49.210474148121463, otherNames: ["Bio Aladin"]},
 "19" : {name: "Luna", imgUrl: "", longitude:16.583711621215556, latitude:49.187628447806674, otherNames: ["Výstavní kino", "Elite", "Deutsche Lichtspiele"]},
 "20" : {name: "Máj", imgUrl: "", longitude:16.530917277329610, latitude:49.176003627659583, otherNames: ["Kino Sokola", "Kino Bosonohy", "Svoboda"]},
 "21" : {name: "Morava", imgUrl: "resources/img/Morava.png", longitude:16.607700789521690, latitude:49.201472844915209, otherNames: ["Bio Universum", "Bio Metro"]},
 "22" : {name: "Oko", imgUrl: "resources/img/Oko.png", longitude:16.595515815143962, latitude:49.221825213876301, otherNames: ["Union"]},
 "23" : {name: "Orania", imgUrl: "resources/img/Orania.png", longitude:16.617769836175416, latitude:49.198945174310872, otherNames: ["Urania"]},
 "24" : {name: "Praha", imgUrl: "resources/img/Praha.bmp", longitude:16.610110956683755, latitude:49.194618995348172, otherNames: ["Bio Alfa"]},
 "25" : {name: "Radost", imgUrl: "", longitude:16.623135378870149, latitude:49.198809456798585, otherNames: ["Kino-Varieté", "Bajkal", "Radio"]},
 "26" : {name: "Scala", imgUrl: "resources/img/Scala.png", longitude:16.608142148678841, latitude:49.197356125091055, otherNames: ["Bio Dopz", "Moskva"]},
 "27" : {name: "Sibiř", imgUrl: "resources/img/Sibir.png", longitude:16.633658765832720, latitude:49.211655730191630, otherNames: ["Zora"]},
 "28" : {name: "Slovan", imgUrl: "", longitude:16.635458818865757, latitude:49.189760782619359, otherNames: ["Kino Avia"]},
 "29" : {name: "Sokolovo", imgUrl: "", longitude:16.651382364927571, latitude:49.228839185751077, otherNames: ["Kino Sokol Obřany"]},
 "30" : {name: "Sport", imgUrl: "", longitude:16.642035935717360, latitude:49.198809456798656, otherNames: ["Bio Slávia"]},
 "31" : {name: "Světozor", imgUrl: "resources/img/Svetozor.png", longitude:16.639197390549828, latitude:49.199442802003169, otherNames: []},
 "32" : {name: "Svoboda", imgUrl: "resources/img/Svoboda.png", longitude:16.591084915370256, latitude:49.190524328441683, otherNames: ["The Loyal", "Starobrněnské kino", "Grand"]},
 "33" : {name: "Úderka", imgUrl: "resources/img/Uderka.png", longitude:16.608462350420282, latitude:49.195546469499831, otherNames: ["The Empire Bio-Co.", "Ufa-Central"]},
 "34" : {name: "Viktoria", imgUrl: "", longitude:16.618773711905359, latitude:49.187679353422347, otherNames: ["Brněnský biograf", "Kino Dornych", "Edison"]},
 "35" : {name: "Vítěz", imgUrl: "", longitude:16.604650218876646, latitude:49.163419723539690, otherNames: ["Kino Adria Horní Heršpice"]}
}

const numOfLevels = 10
const numOfCinemas = Object.keys(data).length
const centerLatLon = new OpenLayers.LonLat(16.608196,49.195047)
const displayStates = {0:'start', 1:'question', 2:'result', 3:'total'}
const markerStates = {0:'without', 1:'true', 2:'false'}

var totalPoints = 0;
var level = 0;
var zoom = 14;
var display = displayStates[0]

///////////////////////

var fromProjection = new OpenLayers.Projection("EPSG:4326"); // transform from WGS 1984
var toProjection = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
var extent = new OpenLayers.Bounds( 16, 48, 17, 50).transform(fromProjection, toProjection);
var options = {restrictedExtent: extent};

map = new OpenLayers.Map("mapdiv", options);

// stamenLayer = new OpenLayers.Layer.Stamen("toner");
// map.addLayer(stamenLayer)

// map.addLayer(new OpenLayers.Layer.OSM.Hot("Hot"));


map.addLayer(new OpenLayers.Layer.OSM())
    // {zoomOffset: 13, resolutions: [19.1092570678711,9.55462853393555,4.77731426696777,2.38865713348389]}));

var markers = new OpenLayers.Layer.Markers("Markers");
map.addLayer(markers);

for(var key in data){
    var lonLat = new OpenLayers.LonLat(data[key].longitude, data[key].latitude)
    .transform(
        fromProjection,
        toProjection
    );
    var marker = new OpenLayers.Marker(lonLat, new OpenLayers.Icon('resources/img/marker_dot.png', new OpenLayers.Size(30,30)));
    marker.id = key;
    marker.events.register("mousedown", marker, function() {
        markerOnClick(this.id);
    });
    marker.events.register("mouseover", marker, function() {
        this.inflate(1.1)
    });
    marker.events.register("mouseout", marker, function() {
        this.inflate(0.9)
    });
    markers.addMarker(marker);
}

var center = centerLatLon
    .transform(
        fromProjection,
        toProjection
    );

map.setCenter(center, zoom);
// map.zoomToExtent(extent);

//////////////////////////////////////////////////////////////////////////////////

const startButton = document.getElementById('startButton');
const exitButton = document.getElementById('exitButton');
const confirmButton = document.getElementById('confirmButton');
const nextButton = document.getElementById('nextButton');
const startPage = document.getElementById('startPage');
const quizPage = document.getElementById('quizPage');
const endPage = document.getElementById('endPage');
const endImg = document.getElementById('endImg');
const endInfo = document.getElementById('endInfo');
const questionResult = document.getElementById('questionResult');
const questionId = document.getElementById('questionId');
const totalResultText = document.getElementById('totalResultText');
const inputNickname = document.getElementById("inputLGEx")
const table = document.getElementById("myTable").getElementsByTagName("tbody")[0];

startButton.addEventListener('click', (event) => {
    display = displayStates[1]

    startPage.style.display = 'none';
    quizPage.style.display = 'block';
    confirmButton.style.display = 'inline-block';
    confirmButton.disabled = true;
    nextButton.style.display = 'none'
    questionResult.innerHTML = ''
    exitButton.style.visibility = "visible";

    nickname = inputNickname.value

    get_levels()
    update_question()

    level ++;
});

exitButton.addEventListener('click', (event) => {
    display = displayStates[0]

    startPage.style.display = 'block';
    quizPage.style.display = 'none';
    endPage.style.display = 'none';
    exitButton.style.visibility = "hidden";
    endInfo.innerHTML = ''
    endImg.src = ""

    level = 0;

    inputNickname.value = '';

    init_center();
    redraw_markers('all');
});

confirmButton.addEventListener('click', (event) => {
    display = displayStates[2]

    confirmButton.style.display = 'none';
    nextButton.style.display = 'inline-block'

    make_result();
    init_center();
});

nextButton.addEventListener('click', (event) => {
    if (cinemaOrder.length == level)
    {
        display = displayStates[3]

        quizPage.style.display = 'none';
        endPage.style.display = 'block';

        total_res = get_total_result()
        totalResultText.innerHTML = ''.concat(inputNickname.value, ', tvoje skóre je ', total_res.toString(),
            '/', numOfLevels)

        var row = table.insertRow(0);
        var cell0 = row.insertCell(0);
        var cell1 = row.insertCell(1);
        var cell2 = row.insertCell(2);

        // cell0.innerHTML = table.getElementsByTagName("tr").length;
        // cell1.innerHTML = inputNickname.value;
        // cell2.innerHTML = total_res;

        redraw_markers('some');

        $($.fn.dataTable.tables(true)).DataTable()
        .columns.adjust();

        var cnt = $('#myTable').DataTable().rows().count()

        $('#myTable').DataTable().row.add([
            cnt + 1,
            inputNickname.value,
            total_res
        ]).draw(false);
    }
    else
    {
        display = displayStates[1]

        confirmButton.style.display = 'inline-block';
        confirmButton.disabled = true;
        nextButton.style.display = 'none'
        questionResult.innerHTML = ''

        redraw_markers('some');
        update_question();
        level ++;
    }
});




$(document).ready(function () {
$('#myTable').DataTable(
    {
        // scrollY:        "200px",
scrollCollapse: true,
paging:         false,
scrollX: "100%",
searching: false,
info:false
    }
);
$('.dataTables_length').addClass('bs-select');
});
